<!-- this is the basic template for the POC opportunities page --> 

<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Opportunities</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
      body {
        background-color: #F5F5F5;
      }
      .container {
        background-color: #FFFFFF;
        margin-top: 50px;
        margin-bottom: 50px;
        padding-top: 20px;
        padding-bottom: 20px;
        border-radius: 5px;
        box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.2);
      }
      .opportunity-card {
        background-color: #EAEAEA;
        margin-bottom: 20px;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0px 0px 5px 0px rgba(0,0,0,0.2);
      }
      .opportunity-card:hover {
        cursor: pointer;
        background-color: #D9D9D9;
      }
      .round-checkbox {
        margin-top: 10px;
      }
      .round-btn {
        margin-top: 20px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Opportunities</h2>
      <div id="opportunities">
        <!-- The opportunities will be dynamically generated using JavaScript -->
      </div>
    </div>

    <!-- Modal for opportunity details -->
    <div id="opportunity-modal" class="modal fade" role="dialog">
      <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Opportunity Details</h4>
          </div>
          <div class="modal-body">
            <div id="opportunity-details">
              <!-- The opportunity details will be dynamically generated using JavaScript -->
            </div>
            <div class="form-group">
              <label for="round-number">Round Number:</label>
              <input type="number" class="form-control" id="round-number">
            </div>
            <table class="table">
              <thead>
                <tr>
                  <th></th>
                  <th>Name</th>
                  <th>Round Number</th>
                </tr>
              </thead>
              <tbody id="students">
                <!-- The students will be dynamically generated using JavaScript -->
              </tbody>
            </table>
            <div class="round-btn">
              <button type="button" class="btn btn-success" id="accepted-btn">Accepted</button>
              <button type="button" class="btn btn-primary" id="next-round-btn">Proceed to Next Round</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function() {
        // Get opportunities for this HR from API
        var poc_email_id = "xyz"; // Replace with actual poc_email_id
      $.get("/api/poc/opportunities?poc_email_id=" + poc_email_id, function(data, status) {
        var opportunities = data.opportunities;
        for (var i = 0; i < opportunities.length; i++) {
          var opportunity = opportunities[i];
          var opportunity_card = "<div class='opportunity-card' data-opp-id='" + opportunity.opp_id + "'>";
          opportunity_card += "<h4>" + opportunity.opp_title + "</h4>";
          opportunity_card += "<p>" + opportunity.address_line_1 + ", " + opportunity.address_line_2 + ", " + opportunity.address_line_3 + "</p>";
          opportunity_card += "<p>" + opportunity.opp_type + "</p>";
          opportunity_card += "</div>";
          $("#opportunities").append(opportunity_card);
        }
      });
  
      // Open modal and get opportunity details and students when an opportunity card is clicked
      $(document).on("click", ".opportunity-card", function() {
        var opp_id = $(this).data("opp-id");
        $.get("/api/poc/opportunity?opp_id=" + opp_id, function(data, status) {
          var opportunity = data.opportunity;
          $("#opportunity-details").html("<h4>" + opportunity.opp_title + "</h4><p>" + opportunity.address_line_1 + ", " + opportunity.address_line_2 + ", " + opportunity.address_line_3 + "</p>");
          var students = data.students;
          $("#students").html("");
          for (var i = 0; i < students.length; i++) {
            var student = students[i];
            var student_row = "<tr><td><input type='checkbox' class='round-checkbox' data-student-id='" + student.student_id + "'></td>";
            student_row += "<td>" + student.student_name + "</td>";
            student_row += "<td>" + student.round_number + "</td></tr>";
            $("#students").append(student_row);
          }
        });
        $("#opportunity-modal").modal("show");
      });
  
      // Handle Accepted button click
      $(document).on("click", "#accepted-btn", function() {
        var opp_id = $("#opportunity-details").find("h4").text(); // Assuming opportunity title is the header
        var round_number = $("#round-number").val();
        var selected_students = [];
        $("#students").find("input:checked").each(function() {
          selected_students.push($(this).data("student-id"));
        });
        if (selected_students.length > 0) {
          var data = {
            "opp_id": opp_id,
            "round_number": round_number,
            "student_ids": selected_students.join(","),
            "status": "accepted"
          };
          $.post("/api/poc/opportunity", data, function(response) {
            if (response.success) {
              $("#opportunity-modal").modal("hide");
              alert("Accepted students: " + selected_students.join(", "));
            } else {
              alert("Error: " + response.message);
            }
          });
        } else {
          alert("Please select at least one student.");
        }
      });
  
      // Handle Proceed to Next Round button click
      $(document).on("click", "#next-round-btn", function() {
        var opp_id = $("#opportunity-details").find("h4").text(); // Assuming opportunity title is the header
        var round_number = $("#round-number").val();
        var selected_students = [];
        $("#students").find("input:checked").each(function() {
          selected_students.push($(this).data("student-id"));
        });
        if (selected_students.length > 0) {
        var data = {
          "opp_id": opp_id,
          "round_number": round_number,
          "student_ids": selected_students.join(","),
          "status": "proceed"
        };
        $.post("/api/poc/opportunity", data, function(response) {
          if (response.success) {
            $("#opportunity-modal").modal("hide");
            alert("Proceeded students: " + selected_students.join(", "));
          } else {
            alert("Error: " + response.message);
          }
        });
        } else {
          alert("Please select at least one student.");
        }
        });
      });
    </script>
  </body>
</html>

